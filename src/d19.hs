module Df19 where 
    import Control.Applicative ((<|>))
    import Data.List.Split (splitOn) 

--(?<!\d)(\d) replace to f$f1, : to =, | to <||>, "(.*?)" to m '$1', (f\d*)\s(f\d*) to $1 <**> $2
-- helper functions

    infixl 6 <||>
    (<||>) :: (String -> [String]) -> (String -> [String]) -> (String -> [String])
    f1 <||> f2 = \x -> case (f1 x, f2 x) of 
                        ([], []) -> []
                        ([], rests) -> rests 
                        (rests, []) -> rests 
                        (rests1, rests2) -> rests1 ++ rests2 

    infixl 7 <**> 
    (<**>) :: (String -> [String]) -> (String -> [String]) -> (String -> [String])
    f1 <**> f2 = \x -> case f1 x of 
                        [] -> []
                        rests -> foldr (++) [] [ f2 r | r <- rests ]


    m::Char -> ([Char] -> [[Char]])
    m ch (c:tl)
        | c == ch = [tl]
        | otherwise = []
    m ch _ = []

    isSuccLine ([]:tl) = True 
    isSuccLine (_:tl) = isSuccLine tl 
    isSuccLine [] = False 

    f101 = f118 <**> f64
    f83 = f132 <**> f118 <||> f108 <**> f2
    f61 = f19 <**> f2
    f33 = f126 <**> f2 <||> f68 <**> f118
    f80 = f2 <**> f48 <||> f118 <**> f91
    f47 = f38 <**> f2 <||> f64 <**> f118
    f40 = f25 <**> f2 <||> f93 <**> f118
    f18 = f38 <**> f2 <||> f108 <**> f118
    f2 = m 'a'
    f74 = f118 <**> f108 <||> f2 <**> f12
    f41 = f118 <**> f17 <||> f2 <**> f58
    f56 = f125 <**> f2 <||> f132 <**> f118
    f66 = f12 <**> f2 <||> f27 <**> f118
    f62 = f118 <**> f52 <||> f2 <**> f125
    f58 = f2 <**> f128 <||> f118 <**> f99
    f89 = f110 <**> f2 <||> f3 <**> f118
    f30 = f118 <**> f85 <||> f2 <**> f21
    f20 = f2 <**> f70 <||> f118 <**> f111
    f85 = f118 <**> f115 <||> f2 <**> f52
    f98 = f118 <**> f46 <||> f2 <**> f10
    f12 = f118 <**> f2 <||> f43 <**> f118
    f99 = f102 <**> f118 <||> f56 <**> f2
    f127 = f2 <**> f119 <||> f118 <**> f100
    f53 = f125 <**> f2 <||> f108 <**> f118
    f15 = f2 <**> f27 <||> f118 <**> f108
    f22 = f95 <**> f2 <||> f61 <**> f118
    f109 = f115 <**> f2 <||> f46 <**> f118
    f90 = f76 <**> f2 <||> f121 <**> f118
    f37 = f15 <**> f118 <||> f23 <**> f2
    f27 = f118 <**> f2 <||> f118 <**> f118
    f104 = f2 <**> f46 <||> f118 <**> f12
    f32 = f64 <**> f2
    f26 = f35 <**> f118 <||> f32 <**> f2
    f123 = f131 <**> f2 <||> f89 <**> f118
    f21 = f118 <**> f132 <||> f2 <**> f115
    f95 = f112 <**> f118 <||> f125 <**> f2
    f79 = f88 <**> f2 <||> f60 <**> f118
    f34 = f107 <**> f2 <||> f133 <**> f118
    f6 = f2 <**> f101 <||> f118 <**> f110
    f55 = f118 <**> f112 <||> f2 <**> f64
    f10 = f2 <**> f118
    f115 = f2 <**> f118 <||> f2 <**> f2
    f39 = f2 <**> f61 <||> f118 <**> f81
    f42 = f92 <**> f118 <||> f124 <**> f2
    f105 = f38 <**> f2 <||> f10 <**> f118
    f7 = f10 <**> f2 <||> f27 <**> f118
    f106 = f87 <**> f2 <||> f1 <**> f118
    f75 = f118 <**> f46
    f28 = f2 <**> f71 <||> f118 <**> f16
    f120 = f118 <**> f27 <||> f2 <**> f112
    f100 = f69 <**> f2 <||> f109 <**> f118
    f102 = f46 <**> f118 <||> f132 <**> f2
    f5 = f39 <**> f118 <||> f51 <**> f2
    f14 = f57 <**> f2 <||> f96 <**> f118
    -- f8 = f42
    f8 = f42 <||> (f42 <**> f8)

    f25 = f118 <**> f59 <||> f2 <**> f67
    f3 = f19 <**> f118 <||> f52 <**> f2
    f59 = f2 <**> f74 <||> f118 <**> f83
    f87 = f118 <**> f72 <||> f2 <**> f78
    f130 = f111 <**> f2 <||> f117 <**> f118
    f112 = f2 <**> f43 <||> f118 <**> f118
    f116 = f118 <**> f38 <||> f2 <**> f108
    f17 = f2 <**> f122 <||> f118 <**> f29
    f124 = f41 <**> f118 <||> f40 <**> f2
    -- f11 = f42 <**> f31
    f11 =  (f42 <**> f31) <||> (f42 <**> f11 <**> f31)

    f38 = f43 <**> f43
    f44 = f118 <**> f123 <||> f2 <**> f114
    f23 = f12 <**> f2
    f29 = f2 <**> f113 <||> f118 <**> f129
    f121 = f2 <**> f10 <||> f118 <**> f19
    f93 = f2 <**> f26 <||> f118 <**> f36
    f13 = f19 <**> f118 <||> f46 <**> f2
    f107 = f118 <**> f132 <||> f2 <**> f10
    f54 = f118 <**> f27 <||> f2 <**> f12
    f63 = f2 <**> f105 <||> f118 <**> f82
    f84 = f2 <**> f37 <||> f118 <**> f73
    f52 = f118 <**> f2 <||> f2 <**> f118
    f50 = f118 <**> f111 <||> f2 <**> f9
    f111 = f118 <**> f112 <||> f2 <**> f27
    f82 = f118 <**> f46 <||> f2 <**> f108
    f118 = m 'b'
    f133 = f115 <**> f2
    f103 = f34 <**> f2 <||> f22 <**> f118
    f36 = f66 <**> f2 <||> f65 <**> f118
    f31 = f33 <**> f118 <||> f79 <**> f2
    f69 = f12 <**> f2 <||> f115 <**> f118
    f122 = f54 <**> f118 <||> f66 <**> f2
    f114 = f6 <**> f118 <||> f80 <**> f2
    f92 = f118 <**> f14 <||> f2 <**> f44
    f0 = f8 <**> f11
    f117 = f132 <**> f2 <||> f108 <**> f118
    f76 = f64 <**> f2 <||> f27 <**> f118
    f126 = f2 <**> f28 <||> f118 <**> f127
    f113 = f125 <**> f2 <||> f19 <**> f118
    f43 = f118 <||> f2
    f46 = f118 <**> f118 <||> f2 <**> f118
    f132 = f118 <**> f118 <||> f2 <**> f2
    f49 = f118 <**> f130 <||> f2 <**> f50
    f129 = f19 <**> f118 <||> f27 <**> f2
    f24 = f2 <**> f27 <||> f118 <**> f52
    f119 = f118 <**> f47 <||> f2 <**> f98
    f91 = f19 <**> f118 <||> f10 <**> f2
    f35 = f115 <**> f118 <||> f46 <**> f2
    f57 = f2 <**> f63 <||> f118 <**> f90
    f125 = f118 <**> f118 <||> f43 <**> f2
    f108 = f118 <**> f118
    f4 = f115 <**> f118 <||> f19 <**> f2
    f94 = f112 <**> f2 <||> f115 <**> f118
    f1 = f2 <**> f55 <||> f118 <**> f75
    f9 = f38 <**> f118 <||> f112 <**> f2
    f71 = f2 <**> f18 <||> f118 <**> f53
    f60 = f103 <**> f2 <||> f86 <**> f118
    f51 = f116 <**> f2 <||> f24 <**> f118
    f128 = f24 <**> f118 <||> f117 <**> f2
    f45 = f118 <**> f2
    f16 = f104 <**> f2 <||> f62 <**> f118
    f70 = f118 <**> f115 <||> f2 <**> f45
    f77 = f118 <**> f13 <||> f2 <**> f94
    f131 = f61 <**> f2 <||> f107 <**> f118
    f68 = f2 <**> f49 <||> f118 <**> f84
    f86 = f118 <**> f97 <||> f2 <**> f30
    f78 = f118 <**> f38 <||> f2 <**> f12
    f88 = f5 <**> f2 <||> f106 <**> f118
    f81 = f2 <**> f45 <||> f118 <**> f52
    f64 = f2 <**> f2
    f19 = f2 <**> f43 <||> f118 <**> f2
    f110 = f132 <**> f2 <||> f64 <**> f118
    f96 = f2 <**> f77 <||> f118 <**> f20
    f67 = f104 <**> f118 <||> f4 <**> f2
    f65 = f115 <**> f118 <||> f38 <**> f2
    f73 = f118 <**> f110 <||> f2 <**> f120
    f72 = f64 <**> f2 <||> f115 <**> f118
    f48 = f2 <**> f46 <||> f118 <**> f10
    f97 = f7 <**> f118 <||> f133 <**> f2    

    f999 = m 'x'
    f9999 = f999 <||> f999 <**> f9999

    p1 = 
        do 
        content <- readFile "inputs/d19"
        let lines = splitOn "\n" $ last $ splitOn "\n\n" content
        let succLines = [ l | l <- lines, isSuccLine $ f0 l]
        return $ length succLines
        -- let lines = "[" ++ intercalate "," ([ replace line | line <- splitOn "\n" content, line /= "" ]) ++ "]"
        -- res <- runInterpreter $ evalLine lines
        -- case res of 
        --     Right lst -> 
        --         print $ sum lst 
        --     Left e -> 
        --         print e 
